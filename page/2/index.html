<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="z-dd, Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="DD'echo" type="application/atom+xml" />






<meta name="description" content="the">
<meta property="og:type" content="website">
<meta property="og:title" content="DD'echo">
<meta property="og:url" content="mark.z-dd.net/page/2/index.html">
<meta property="og:site_name" content="DD'echo">
<meta property="og:description" content="the">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DD'echo">
<meta name="twitter:description" content="the">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="mark.z-dd.net/page/2/"/>





  <title>DD'echo</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b14f9da97755a6abfecfdf85a4cc1a4e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DD'echo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">the quieter you become, the more you are able to hear.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2015/10/27/wpa-supplicant-iwconfig/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/27/wpa-supplicant-iwconfig/" itemprop="url">wpa_supplicant & iwconfig</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-27T19:26:56+08:00">
                2015-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index">
                    <span itemprop="name">tools</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###<strong>wpa_supplican</strong></p>
<p>用wpa_passphrase生成最基本的wpa_supplicant配置文件：</p>
<pre><code>wpa_passphrase TPLINK 12345678 |sudo tee -a /etc/wpa_supplicant/wpa_supplicant.conf
</code></pre><p>wpa_supplication.conf的模板如下：</p>
<pre><code>ctrl_interface=/var/run/wpa_supplicant
ctrl_interface_group=wheel
update_config=1
network=
{
    ssid=&quot;xxxx&quot;
    scan_ssid=1
    psk=xxxxxxxxx37bca5cf24a345f514d319211822f568bba28f8f0b74c894e7644
    proto=RSN
    key_mgmt=WPA-PSK
    pairwise=CCMP
    auth_alg=OPEN
}
</code></pre><p>连接命令：</p>
<pre><code>wpa_supplicant -B -d -iwlan0 -c/etc/wpa_supplicant.conf
</code></pre><p>动态获取IP：</p>
<pre><code>dhclient wlan0
</code></pre><p>###<strong>iwconfig</strong></p>
<p>扫描AP节点：<br>    iwlist wlan4 scanning</p>
<p>配置MYSSID：<br>    iwconfig wlan0 essid “myssid”</p>
<p>加密码：<br>    iwconfig wlan0 key s:xxxxx/xxxxxxxxxxxxx（40－bit为5个ASSIC字符，128－bit为13个ASSIC字符，以字符为密钥时，密钥之前需要加s:表示字符）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2015/10/19/openwrt-相关有用的/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/19/openwrt-相关有用的/" itemprop="url">openwrt 相关有用的</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-19T14:46:54+08:00">
                2015-10-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openwrt/" itemprop="url" rel="index">
                    <span itemprop="name">openwrt</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>config_load等获取config配置文件：</p>
<pre><code>#!/bin/sh /etc/rc.common
# Copyright (C) 2013 NXP Semiconductor
# -s /dev/ttyTX0 -B 115200 --mode=coordinator -6 fd04:bd3:80e8:10::1 -c 15 -I zb0

START=99

PROG=zigbee-jip-daemon

start_zigbee_jip_daemon() {
    local section=&quot;$1&quot;

    config_get_bool ignore &quot;$section&quot; ignore 0
    [ &quot;$ignore&quot; -ne 0 ] &amp;amp;&amp;amp; return 0

    local tty
    config_get tty &quot;${section}&quot; tty
    [ -z $tty ] &amp;amp;&amp;amp; tty=&quot;/dev/ttyUSB0&quot;

    local interface
    config_get interface &quot;${section}&quot; interface

    local baudrate
    config_get baudrate &quot;${section}&quot; baudrate
    [ -z $baudrate ] &amp;amp;&amp;amp; baudrate=&quot;1000000&quot;

    local mode
    config_get mode &quot;${section}&quot; mode

    local borderrouter
    config_get borderrouter &quot;${section}&quot; borderrouter

    local channel
    config_get channel &quot;${section}&quot; channel

    local whitelisting
    config_get whitelisting &quot;${section}&quot; whitelisting

    local args
    args=&quot;-s $tty -B $baudrate --mode=$mode -6 $borderrouter -c $channel&quot;

    if [ $interface ]
    then
        args=&quot;$args -I $interface&quot;
    fi

    if [ $whitelisting -ne 0 ]
    then
        args=&quot;$args --whitelisting&quot;
    fi

    echo &quot;Starting $PROG with arguments: $args&quot;
    /usr/sbin/$PROG $args
}
start () {
    config_load zigbee-jip-daemon
    config_foreach start_zigbee_jip_daemon zigbee-jip-daemon
}
stop () {
    killall $PROG
}
</code></pre><p>log操作：</p>
<pre><code>logread
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2015/10/16/hello-echo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/16/hello-echo/" itemprop="url">hello,echo! hello,world!</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-16T21:27:20+08:00">
                2015-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="hello-echo-hello-world"><a href="#hello-echo-hello-world" class="headerlink" title="hello,echo! hello,world!"></a>hello,echo! hello,world!</h2><h2 id="DD’echo-echo-z-dd-net"><a href="#DD’echo-echo-z-dd-net" class="headerlink" title="DD’echo: echo.z-dd.net"></a><a href="http://echo.z-dd.net/" target="_blank" rel="external">DD’echo</a>: <a href="">echo.z-dd.net</a></h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2015/02/11/Linux常用命令-（持续更新中。。。）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/02/11/Linux常用命令-（持续更新中。。。）/" itemprop="url">Linux常用命令--（持续更新中。。。）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-02-11T21:12:23+08:00">
                2015-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux-common/" itemprop="url" rel="index">
                    <span itemprop="name">linux common</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##<br>    SSH：</p>
<pre><code>http://www.live-in.org/archives/832.html
</code></pre><blockquote>
<p>不指定用户：<br>ssh 192.168.0.11<br>指定用户：<br>ssh -l root 192.168.0.11<br>ssh root@192.168.0.11<br>如果修改过ssh登录端口的可以：<br>ssh -p 12333 192.168.0.11<br>ssh -l root -p 12333 216.230.230.114<br>ssh -p 12333 root@216.230.230.114<br>另外修改配置文件/etc/ssh/sshd_config，可以改ssh登录端口和禁止root登录。改端口可以防止被端口扫描。<br>编辑配置文件：<br>vim /etc/ssh/sshd_config<br>找到#Port 22，去掉注释，修改成一个五位的端口：<br>Port 12333<br>找到#PermitRootLogin yes，去掉注释，修改为：<br>PermitRootLogin no<br>重启sshd服务：<br>service sshd restart<br>退出登陆<br>Exit</p>
</blockquote>
<p>##<br>    查看显卡状态：</p>
<blockquote>
<p>lspci | grep VGA<br>rev ff 表示显卡已经关闭</p>
</blockquote>
<p>##<br>    Mount:</p>
<pre><code>sudo mount -r -t cifs //192.168.12.128/share /mnt/tmp -o username=lierda,password=123456
</code></pre><p><a href="http://tutu.spaces.eepw.com.cn/articles/article/item/70737" target="_blank" rel="external">http://tutu.spaces.eepw.com.cn/articles/article/item/70737</a></p>
<p>##<br>    常用的APT命令参数</p>
<blockquote>
<p>apt-cache search package 搜索包<br>apt-cache show package 获取包的相关信息，如说明、大小、版本等<br>sudo apt-get install package 安装包<br>sudo apt-get install package - - reinstall 重新安装包<br>sudo apt-get -f install 修复安装&quot;-f = ――fix-missing&quot;<br>sudo apt-get remove package 删除包<br>sudo apt-get remove package - - purge 删除包，包括删除配置文件等<br>sudo apt-get update 更新源<br>sudo apt-get upgrade 更新已安装的包<br>sudo apt-get dist-upgrade 升级系统<br>sudo apt-get dselect-upgrade 使用 dselect 升级<br>apt-cache depends package 了解使用依赖<br>apt-cache rdepends package 是查看该包被哪些包依赖<br>sudo apt-get build-dep package 安装相关的编译环境<br>apt-get source package 下载该包的源代码<br>sudo apt-get clean &amp;&amp; sudo apt-get autoclean 清理无用的包<br>sudo apt-get check 检查是否有损坏的依赖<br>apt-get autoremove    </p>
<p><span style="line-height:1;">apt-cache search package 搜索包</span> </p>
<p><span style="line-height:1;">apt-cache show package 获取包的相关信息</span><span style="line-height:1;"></span></p>
</blockquote>
<p>##<br>    磁盘空间查看：</p>
<pre><code>用df命令查看分区情况 $df -h
</code></pre><p>用du命令查看文件或文件夹的磁盘使用空间:<br>$ du -h –max-depth=1 或 $ du -h –max-depth=0</p>
<p>##<br>    source</p>
<pre><code>source命令也称为“点命令”，也就是一个点符号（.）。source命令通常用于重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录
</code></pre><p>##<br>    修改文件或目录用户组和用户</p>
<pre><code>chown [-R] 账号名称:用户组名称 文件或目录
</code></pre><p>##<br>    防火墙</p>
<pre><code>sudo ufw disable 关闭防火墙
</code></pre><p>sudo ufw enable 开启防火墙<br>sudo ufw status 检查防火墙的状态</p>
<p>##<br>    解压：</p>
<pre><code>tar.gz 解压:tar -zxvf 压缩：tar -zcvf
</code></pre><p>tar.bz2 解压:tar -jxvf xx.tar.bz2</p>
<p>##<br>    查找：</p>
<pre><code>find 路径 -name &amp;quot;*log&amp;quot;
</code></pre><p>##<br>    修改网关与指定路由：</p>
<pre><code>修改默认网关：route add default gw 192.168.0.254
</code></pre><p>指定路由：route add -net 192.168.10.0 netmask 255.255.255.0 dev eth0</p>
<p>##<br>    Busybox的tftp命令：</p>
<pre><code>tftp -g -l /usr/APP -r APP 192.168.12.128
</code></pre><p>##<br>        实时监控网络：    </p>
<p>nethogs</p>
<h2 id="安装使用Shadowsocks："><a href="#安装使用Shadowsocks：" class="headerlink" title="安装使用Shadowsocks："></a><span style="font-size: 16px; font-family: &#39;arial black&#39;, &#39;avant garde&#39;;">安装使用Shadowsocks：</span></h2><blockquote>
<p>apt-get&nbsp;install python-pip<br>pip install shadowsocks</p>
<p>sslocal -s server_ip -p server_port &nbsp;-b 127.0.0.1 -l 1080 -k password &nbsp;-t 600 &nbsp;-m aes-256-cfb</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2015/01/11/ubuntu14-04环境配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/01/11/ubuntu14-04环境配置/" itemprop="url">ubuntu14.04环境配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-11T21:17:21+08:00">
                2015-01-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##<br>    1.重启后亮度无法保存</p>
<p>查看本机最大亮度值：cat /sys/class/backlight/XXX/max_brightness（XXX为你的显卡）<br>编辑/etc/rc.local启动初始化文件，在最后一行（exit 0）之前添加：<br>echo 15（你设置的值） &gt; /sys/class/backlight/XXX/brightness（XXX为你的显卡）<br><strong>exit 0</strong>&nbsp;(别忘了)</p>
<p>##<br>    2.休眠后无法启动</p>
<p>Ubuntu 14.04系统下，休眠之后无法启动的问题解决：<br><a href="http://blog.csdn.net/blueheart20/article/details/37995049" target="_blank" rel="external">http://blog.csdn.net/blueheart20/article/details/37995049</a> （与显卡驱动有关）<br>linux学习笔记（7）=》ubuntu挂起后无法唤醒-解决：（缺失laptop_mode）<br><a href="http://blog.sina.com.cn/s/blog_7ec12e960100rfpn.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_7ec12e960100rfpn.html</a> </p>
<p>##<br>    3.鼠标箭头闪烁问题，显卡驱动问题</p>
<p>安装NVIDIA显卡驱动：（bumblebee）—开始使用的方法<br><a href="http://www.jb51.net/os/Ubuntu/84218.html" target="_blank" rel="external">http://www.jb51.net/os/Ubuntu/84218.html</a><br>显卡切换，关闭独显在14.04上没用<br><a href="http://www.douban.com/note/298832176/" target="_blank" rel="external">http://www.douban.com/note/298832176/</a><br>Ubuntu 14.04为Intel/Nvidia双显卡调节亮度:(Prime，比 Bumblebee 成熟)—最终使用方法<br><a href="http://www.mintos.org/config/intel-nvidia-brightness.html" target="_blank" rel="external">http://www.mintos.org/config/intel-nvidia-brightness.html</a><br>sudo apt-get install nvidia-319 nvidia-settings-319 nvidia-prime<br>安装完毕，还要安装一个 Nvidia Prime 双显卡切换指示器，用于在系统托盘中轻点鼠标即可切换显卡，而不必使用命令。在终端中使用如下 PPA 安装：<br>sudo add-apt-repository ppa:nilarimogard/webupd8<br>sudo apt-get update<br>sudo apt-get install prime-indicator<br>想解决亮度及休眠问题–&gt;想安装显卡驱动—》不知道型号—&gt;想用官网的自动检测–&gt;缺少JAVA（TM）–&gt;下载安装了OpenJDK（使用软件中心）–&gt;安装浏览器插件Icedtea（使用软件中心）–&gt;浏览器检测不到插件–&gt;Icedtea不再支持高版本的chrome–&gt;安装其他版本的JAVA</p>
<p>##<br>    安装JAVA：</p>
<p><a href="http://blog.sina.com.cn/s/blog_53a99cf30102v6o4.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_53a99cf30102v6o4.html</a><br>sudo add-apt-repository ppa:webupd8team/java<br>sudo apt-get update<br>sudo apt-get install Oracle-java8-installer<br>设置 Java 8 环境变量：<br>sudo apt-get install oracle-java8-set-default<br>切换为 Java 7 ：<br>sudo update-java-alternatives -s java-7-oracle<br>再切换为 Java 8：<br>sudo update-java-alternatives -s java-8-oracle<br>切换JAVA版本<br>update-alternatives –config java<br>update-alternatives –config javac<br>在ubuntu的chrome中启用java plugin：<br><a href="http://blog.csdn.net/xiajian2010/article/details/10219589" target="_blank" rel="external">http://blog.csdn.net/xiajian2010/article/details/10219589</a> </p>
<p>##<br>    QT安装：</p>
<p><a href="http://www.cnblogs.com/striver-zhu/p/3918275.html" target="_blank" rel="external">http://www.cnblogs.com/striver-zhu/p/3918275.html</a> </p>
<p>##<br>    Samba共享</p>
<p>Ubuntu挂载windows共享文件夹：<br><a href="http://blog.csdn.net/fulinus/article/details/21086581" target="_blank" rel="external">http://blog.csdn.net/fulinus/article/details/21086581</a><br>samba:<br><a href="http://www.cnblogs.com/ouuy/archive/2011/10/24/2223164.html" target="_blank" rel="external">http://www.cnblogs.com/ouuy/archive/2011/10/24/2223164.html</a><br>sudo gedit /etc/samba/smb.conf 新增如下语句:<br>[share]<br>path = /xxx &nbsp;//共享目录<br>available = yes<br>browsealbe = yes<br>public = yes<br>writable = yes<br>read only=yes<br>valid users = xxx//用户名<br>create mask = 0700<br>directory mask = 0700<br>force user = nobody<br>force group = nogroup<br>workgroup = WORKGROUP<br>display charset = UTF-8 //防止windows显示乱码<br>unix charset = UTF-8<br>dos charset = cp936<br>新增登录用户密码<br>sudo touch /etc/samba/smbpasswd<br>sudo smbpasswd -a xxx</p>
<p>##<br>    安装flash插件：</p>
<p>1.Chromium谷歌的开源浏览器将不再支持Netscape浏览器插件API，Adobe公司的Flash将无法正常工作了。然而用户可以使用Pepper Flash Player，这是谷歌浏览器上一款替代Adobe Flash的插件。<br>Ubuntu 14.04及衍生版本用户命令:<br>sudo apt-get update<br>sudo apt-get install chromium-browser<br>sudo apt-get install pepperflashplugin-nonfree<br>sudo update-pepperflashplugin-nonfree –install<br>卸载命令：<br>sudo apt-get remove chromium-browser pepperflashplugin-nonfree<br>2.firefox:sudo apt-get install flashplugin-installer</p>
<p>##<br>    NFS安装时：</p>
<p>注：rpcbind（Ubuntu14.04）就是高版本的portmap<br>注意此时可能会出现：Not starting: portmapper is not running //重启Ubuntu系统后就好了;<br>win7 中使用NFS共享：&nbsp;<a href="http://www.cnblogs.com/itech/archive/2012/06/17/2552514.html" target="_blank" rel="external">http://www.cnblogs.com/itech/archive/2012/06/17/2552514.html</a><br>可以用来测试<br>Cifs取代了smbfs</p>
<p>##<br>    VNC：</p>
<p><span style="font-size:14px;">1.vino-server</span><br><span style="font-size:14px;">运行dconf-editor，注意一定要用当前用户来运行，不能加sudo，依次展开org-&gt;gnome-&gt;desktop-&gt;remote-access</span><span style="font-size:14px;">，这里也可以直接设置远程控制选项，但重要的是将“requre-encryption”去掉</span><span style="font-size:14px;">，但是没有密码,需要点图标设置</span><span style="font-size:14px;">。此方法有点卡，占用带宽太大</span></p>
<p><span style="font-size:14px;">2.vnc4server</span> </p>
<p>##<br>    用户管理：</p>
<p><span style="font-size:14px;">新建用户：useradd，修改密码：passwd，但home目录并没有创建对应的用户文件夹，我们需要添加选项,主动创建用户文件夹和指定shell</span><br>userdel -r xxx&nbsp;&nbsp; &nbsp;<br>useradd xxx -m -s /bin/bash<br><span style="font-size:14px;">note:</span><br><span style="font-size:14px;">useradd username不会在/home下建立一个文件夹username</span><br><span style="font-size:14px;">adduser username会在/home下建立一个文件夹username</span><br><span style="font-size:14px;">useradd -m username跟adduser一样，可以建立一个文件夹username</span> </p>
<p>##<br>    samba：</p>
<p><pre class="prettyprint lang-bsh linenums">sudo&nbsp;apt-get&nbsp;update<br>sudo&nbsp;apt-get&nbsp;install&nbsp;samba&nbsp;samba-common<br>sudo&nbsp;gedit&nbsp;/etc/samba/smb.conf</pre>&gt; max log size = 1000</p>
<blockquote>
<p>security = user<br>[mpushare]<br>comment = mpu_share<br>path = /home/share<br>browseable = yes<br>writable = yes</p>
</blockquote>
<p><span style="font-size:14px;">修改用户及加到smb组： </span></p>
<p><span style="font-size:14px;">sudo smbpasswd -a xxx<br>重启服务：<br></span></p>
<p><span style="font-size:14px;"><br>    sudo service smbd restart</span></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2015/01/05/拯救我的Ubuntu14-04（kylin）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/01/05/拯救我的Ubuntu14-04（kylin）/" itemprop="url">拯救我的Ubuntu14.04（kylin）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-05T21:18:53+08:00">
                2015-01-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h3><p>双硬盘，双系统（SSD-&gt;win8.1，HDD-&gt;Ubuntu14.04），HDD是原笔记本的硬盘，只有320G，而且本来就不咋地，很大的吱吱声音，速度也很慢很卡。HDD其中120G为Ubuntu，当时挂载分区的时候，根目录分的是50G，装完系统就剩40多G了，Home目录为70G。<br>打算自己开始编译imx6的Android源码，10G多的源码放在根目录下的/mnt，折腾了一天多，终于编译好了一个目标板的。接着没看剩余磁盘大小就编译第二个目标板的，从晚上开始编译，觉得早上应该就差不多了。第二天早上一看，系统提示磁盘空间不足，然后很卡。就用那个优客助手想清理下，结果系统就越来越卡，UI渐渐消失了，系统崩溃了。最后重启结果就进不了系统了，一直停在启动界面。</p>
<h3 id="自己解决步骤："><a href="#自己解决步骤：" class="headerlink" title="自己解决步骤："></a>自己解决步骤：</h3><h4 id="第一次："><a href="#第一次：" class="headerlink" title="第一次："></a>第一次：</h4><p>在停住的启动界面按Esc进入非图形启动界面，发现lightdm&nbsp;display&nbsp;manager&nbsp;fail。Ctrl+Alt+F1&nbsp;由桌面图形模式进命令行模式，命令行中文乱码<br>修改Ubuntu的命令行语言环境：<br>1、修改/etc/default/locale<br>如不存在则新建一个<br>如下：<br>LANG=’en_US’&nbsp;#中文可以用zh_CN<br>LANGUAGE=’en_US:en’&nbsp;#中文可以用zh_CN:zh<br>2、reboot即可<br>locale命令可以列出当前系统所用的所有语言设置<br>查看/var/log/lightdm，发现默认配置都丢失了，查看/etc/lightdm/，果然没了。经过很多种尝试，发现桌面lightdm始终不行，打算重新安装桌面。<br>但发现Apt丢失了（apt-get&nbsp;command&nbsp;not&nbsp;found），幸好dpkg还在，网也能通，打算用dpkg安装apt，找了半天资料，才找到个能下包的地方，小白啊，没办法，安装<a href="http://www.cnblogs.com/huangbangshun/p/4174922.html" target="_blank" rel="external">apt</a>，包:<a href="http://mirrors.163.com/ubuntu/pool/main/a/apt/" target="_blank" rel="external">（apt_1.0.1ubuntu2_amd64）</a></p>
<p>后面用apt安装其他包，又遇到Apt依赖项问题（Ubuntu&nbsp;unmet&nbsp;dependencies），安装任何包都会报依赖项问题，又折腾了半天，找了半天，apt-get&nbsp;dist-upgrade&nbsp;升级系统&nbsp;，sudo&nbsp;apt-get&nbsp;upgrade&nbsp;更新已安装的包&nbsp;，重新安装桌面（ubuntu-desktop），搞定，可以正常了。</p>
<h4 id="第二次："><a href="#第二次：" class="headerlink" title="第二次："></a>第二次：</h4><p>也是用优客助手（类似于win下面的360卫士，可以清理）后，系统又崩溃了。这次更彻底，Apt丢失，它的一些依赖包也丢了，网也不行了，无线网卡没起来，eth幸好敲命令能起来（ipconfig&nbsp;eth0&nbsp;up）。下载依赖包（<a href="http://www.ubuntuupdates.org/" target="_blank" rel="external">http://www.ubuntuupdates.org/</a>&nbsp;），发现依赖包存在版本依赖，折腾半天终于安装好了apt，后面的步骤就同第一次了。</p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>越来越能体会命令行的好处了</p>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><p>ubuntu&nbsp;lightdm登陆器不能用户登陆解决：<br><a href="http://www.2cto.com/os/201305/213215.html" target="_blank" rel="external">http://www.2cto.com/os/201305/213215.html</a> </p>
<p>ubuntu中apt-get，dpkg与默认路径:<br><a href="http://blog.chinaunix.net/uid-25436678-id-3853747.html" target="_blank" rel="external">http://blog.chinaunix.net/uid-25436678-id-3853747.html</a> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i &lt;package.deb&gt;  dpkg -p&lt;package.deb&gt;</span><br></pre></td></tr></table></figure>
<p>Recovery模式&nbsp;按e</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2014/12/12/Linux驱动系列-1-Misc-混杂-设备之GPIO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/12/12/Linux驱动系列-1-Misc-混杂-设备之GPIO/" itemprop="url">Linux驱动系列?1.Misc(混杂)设备之GPIO</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-12-12T21:23:15+08:00">
                2014-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>## </p>
<h3 id="Misc设备-nbsp-–-nbsp-特殊的字符设备"><a href="#Misc设备-nbsp-–-nbsp-特殊的字符设备" class="headerlink" title="Misc设备&nbsp;–&nbsp;特殊的字符设备"></a>Misc设备&nbsp;–&nbsp;特殊的字符设备</h3><p>本质上仍然是字符设备，只是被增加了以层封装而已。Misc设备共享一个主设备号MISC_MAJOR（10），但次设备号不同（系统最多有255个杂项设备），所有的misc设备形成一个链表，对设备访问时内核根据次设备号查找对应的&nbsp;misc设备，然后调用其中的file_operations结构体中注册的文件操作接口进行操作，因此其驱动的主体工作还是file_operations的成员函数。</p>
<h4 id="1-字符设备模板及说明解析："><a href="#1-字符设备模板及说明解析：" class="headerlink" title="1.字符设备模板及说明解析："></a>1.字符设备模板及说明解析：</h4><p>1.<a href="http://blog.csdn.net/wdzxl198/article/details/8817147" target="_blank" rel="external">http://blog.csdn.net/wdzxl198/article/details/8817147</a>&nbsp;（自动创建设备节点）<br>2.<a href="http://blog.chinaunix.net/uid-20698426-id-136243.html" target="_blank" rel="external">http://blog.chinaunix.net/uid-20698426-id-136243.html</a><br>主要是init函数(获取设备号，创建节点)&nbsp;，exit函数（回收操作），及设备操作集对应的操作函数。</p>
<h4 id="2-设备操作集file-operations结构体分析"><a href="#2-设备操作集file-operations结构体分析" class="headerlink" title="2.设备操作集file_operations结构体分析:"></a>2.设备操作集file_operations结构体分析:</h4><p><a href="http://www.linuxidc.com/Linux/2011-09/43530.htm" target="_blank" rel="external">http://www.linuxidc.com/Linux/2011-09/43530.htm</a> </p>
<p>特别的异步IO轮询函数：<br>    unsigned int (<em>poll)(struct file </em>, struct poll_table_struct *);<br>(这是一个设备驱动中的轮询函数，第一个参数为file结构指针，第二个为轮询表指针）<br>这个函数返回设备资源的可获取状态，即POLLIN，POLLOUT，POLLPRI，POLLERR，POLLNVAL等宏的位“或”结果。<br>每个宏都表明设备的一种状态，如：POLLIN（定义为0x0001）意味着设备可以无阻塞的读，POLLOUT（定义为0x0004）意味着设备可以无阻塞的写。<br>(poll&nbsp;方法是&nbsp;3&nbsp;个系统调用的后端:&nbsp;poll,&nbsp;epoll,&nbsp;和&nbsp;select,&nbsp;都用作查询对一个或多个文件描述符的读或写是否会阻塞.<br>poll&nbsp;方法应当返回一个位掩码指示是否非阻塞的读或写是可能的,&nbsp;并且,&nbsp;可能地,&nbsp;提供给内核信息用来使调用进程睡眠直到&nbsp;I/O&nbsp;变为可能.<br>如果一个驱动的&nbsp;poll&nbsp;方法为&nbsp;NULL,&nbsp;设备假定为不阻塞地可读可写.<br>(这里通常将设备看作一个文件进行相关的操作，而轮询操作的取值直接关系到设备的响应情况，可以是阻塞操作结果，同时也可以是非阻塞操作结果）</p>
<h4 id="3-ioctl函数详解："><a href="#3-ioctl函数详解：" class="headerlink" title="3.ioctl函数详解："></a>3.ioctl函数详解：</h4><p><a href="http://blog.csdn.net/shanshanpt/article/details/19897897" target="_blank" rel="external">http://blog.csdn.net/shanshanpt/article/details/19897897</a> </p>
<p>ioctl函数的cmd：<br>cmd的大小为&nbsp;32位，共分&nbsp;4&nbsp;个域：<br>bit31~bit30&nbsp;2位为&nbsp;“区别读写”&nbsp;区，作用是区分是读取命令还是写入命令。<br>bit29~bit15&nbsp;14位为&nbsp;”数据大小”&nbsp;区，表示&nbsp;ioctl()&nbsp;中的&nbsp;arg&nbsp;变量传送的内存大小。<br>bit20~bit08&nbsp;&nbsp;8位为&nbsp;“魔数”(“幻数”)区，这个值用以与其它设备驱动程序的&nbsp;ioctl&nbsp;命令进行区别。<br>bit07~bit00&nbsp;&nbsp;&nbsp;8位为&nbsp;”区别序号”&nbsp;区，是区分命令的命令顺序序号。</p>
<p>这几个宏的使用格式为：</p>
<ul>
<li>_IO&nbsp;(魔数，&nbsp;基数);</li>
<li>_IOR&nbsp;(魔数，&nbsp;基数，&nbsp;变量型)</li>
<li>_IOW&nbsp;&nbsp;(魔数，&nbsp;基数，&nbsp;变量型)</li>
<li><p>_IOWR&nbsp;(魔数，&nbsp;基数，变量型&nbsp;)</p>
<p><strong>魔数&nbsp;(magic&nbsp;number)</strong><br>魔数范围为&nbsp;0~255&nbsp;。通常，用英文字符&nbsp;”A”&nbsp;~&nbsp;”Z”&nbsp;或者&nbsp;”a”&nbsp;~&nbsp;”z”&nbsp;来表示。设备驱动程序从传递进来的命令获取魔数，然后与自身处理的魔数想比较，如果相同则处理，不同则不处理。魔数是拒绝误使用的初步辅助状态。设备驱动&nbsp;程序可以通过&nbsp;_IOC_TYPE&nbsp;(cmd)&nbsp;来获取魔数。不同的设备驱动程序最好设置不同的魔数，但并不是要求绝对，也是可以使用其他设备驱动程序已用过的魔数。</p>
<p><strong>基(序列号)数</strong><br>基数用于区别各种命令。通常，从&nbsp;0开始递增，相同设备驱动程序上可以重复使用该值。例如，读取和写入命令中使用了相同的基数，设备驱动程序也能分辨出来，原因在于设备驱动程序区分命令时&nbsp;使用&nbsp;switch&nbsp;，且直接使用命令变量&nbsp;cmd值。创建命令的宏生成的值由多个域组合而成，所以即使是相同的基数，也会判断为不同的命令。设备驱动程序想要从命令中获取该基数，就使用下面的宏：<br>_IOC_NR&nbsp;(cmd)<br>通常，switch&nbsp;中的&nbsp;case&nbsp;值使用的是命令的本身。</p>
<p><strong>变量型</strong><br>变量型使用&nbsp;arg&nbsp;变量指定传送的数据大小，但是不直接代入输入，而是代入变量或者是变量的类型，原因是在使用宏创建命令，已经包含了&nbsp;sizeof()&nbsp;编译命令。</p>
<p>Linux内核中_IO,_IOR,_IOW,_IOWR宏的用法与解析：<a href="http://blog.csdn.net/hzn407487204/article/details/7995041" target="_blank" rel="external">http://blog.csdn.net/hzn407487204/article/details/7995041</a> </p>
</li>
</ul>
<h4 id="4-misc设备相关："><a href="#4-misc设备相关：" class="headerlink" title="4.misc设备相关："></a>4.misc设备相关：</h4><p><strong>misc设备结构体：</strong><br>struct&nbsp;miscdevice&nbsp;&nbsp;{<br>int&nbsp;minor;&nbsp;&nbsp;//次设备号，若为&nbsp;MISC_DYNAMIC_MINOR&nbsp;自动分配<br>const&nbsp;char&nbsp;<em>name;&nbsp;&nbsp;//设备名<br>const&nbsp;struct&nbsp;file_operations&nbsp;</em>fops;&nbsp;&nbsp;//设备文件操作结构体<br>struct&nbsp;list_head&nbsp;list;&nbsp;&nbsp;&nbsp;&nbsp;//misc_list链表头<br>struct&nbsp;device&nbsp;<em>parent;<br>struct&nbsp;device&nbsp;</em>this_device;</p>
<p>};</p>
<p><strong>misc设备注册和注销API：</strong><br>int&nbsp;misc_register(struct&nbsp;miscdevice&nbsp;<em>misc)<br>int&nbsp;misc_deregister(struct&nbsp;miscdevice&nbsp;</em>misc)</p>
<p><strong>misc设备驱动模型及实例解析：</strong><br>参考：<a href="http://blog.csdn.net/chenlong12580/article/details/7339127" target="_blank" rel="external">http://blog.csdn.net/chenlong12580/article/details/7339127</a> </p>
<h4 id="5-具体实例："><a href="#5-具体实例：" class="headerlink" title="5.具体实例："></a>5.具体实例：</h4><p>详见code文件夹</p>
<ul>
<li>输出</li>
<li>输入</li>
<li><p>中断</p>
<p>4步曲：<br>Step1：定义申明IO口，特别是管脚复用。<br>Step2：平台初始化时初始化对应IO。<br>Step3：创建编写对应的驱动代码&nbsp;C文件。<br>Step4：修改对应的Kconfig，Makefile文件，并配置加载编译。</p>
<p>中断参考：<br><a href="http://blog.csdn.net/mashang123456789/article/details/8623786" target="_blank" rel="external">http://blog.csdn.net/mashang123456789/article/details/8623786</a> </p>
<p>GPIO&nbsp;API:<br><a href="http://blog.sina.com.cn/s/blog_a6559d9201015vx9.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_a6559d9201015vx9.html</a> </p>
<p>与中断有关的API：<br>static&nbsp;inline&nbsp;int&nbsp;gpio_to_irq(unsigned&nbsp;gpio)</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2014/12/09/Linux系列-2-磁盘分区和Linux根文件系统-目录结构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/12/09/Linux系列-2-磁盘分区和Linux根文件系统-目录结构/" itemprop="url">Linux系列--2.磁盘分区和Linux根文件系统,目录结构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-12-09T21:22:14+08:00">
                2014-12-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##DD初学Linux系列–2.磁盘分区和Linux文件系统,目录结构 #</p>
<pre><code>----------
</code></pre><p>来源：1.<a href=""><a href="http://linux-wiki.cn/wiki/zh-hans/Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" target="_blank" rel="external">http://linux-wiki.cn/wiki/zh-hans/Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84</a></a><br>2.<a href="&quot;鸟哥的私房菜&quot;"><a href="http://vbird.dic.ksu.edu.tw/linux_basic/0130designlinux_2.php" target="_blank" rel="external">http://vbird.dic.ksu.edu.tw/linux_basic/0130designlinux_2.php</a></a></p>
<h4 id="一、根文件系统"><a href="#一、根文件系统" class="headerlink" title="一、根文件系统"></a>一、根文件系统</h4><p><strong>/bin</strong><br>这一目录中存放了供所有用户使用的完成基本维护任务的命令。其中bin是binary的缩写，表示二进制文件，通常为可执行文件。一些常用的系统命令，如cp、ls等保存在该目录中。</p>
<p><strong>/boot</strong><br>这里存放的是启动Linux时使用的一些核心文件。如操作系统内核、引导程序Grub等。</p>
<p><strong>/dev</strong><br>在此目录中包含所有的系统设备文件。从此目录可以访问各种系统设备。如CD-ROM，磁盘驱动器，调制解调器和内存等。在该目录中还包含有各种实用功能，如用于创建设备文件的MAKEDEV。</p>
<p><strong>/etc</strong><br>该目录中包含系统和应用软件的配置文件。</p>
<p><strong>/etc/passwd</strong><br>该目录中包含了系统中的用户描述信息，每行记录一个用户的信息。</p>
<p><strong>/home</strong><br>存储普通用户的个人文件。每个用户的主目录均在/home下以自己的用户名命名。</p>
<p><strong>/lib</strong><br>这个目录里存放着系统最基本的共享链接库和内核模块。共享链接库在功能上类似于Windows里的.dll文件。</p>
<p><strong>/lib64</strong><br>64位系统有这个文件夹，64位程序的库。</p>
<p><strong>/lost+found</strong><br>这并不是Linux目录结构的组成部分，而是ext3文件系统用于保存丢失文件的地方。不恰当的关机操作和磁盘错误均会导致文件丢失，这意味着这些被标注为“在使用”，但却并未列于磁盘上的数据结构上。正常情况下，引导进程会运行fsck程序，该程序能发现这些文件。除了“/”分区上的这个目录外，在每个分区上均有一个lost+found目录。</p>
<p><strong>/media</strong><br>可移动设备的挂载点，当前的操作系统通常会把U盘等设备自动挂载到该文件夹下。</p>
<p><strong>/mnt</strong><br>临时用于挂载文件系统的地方。一般情况下这个目录是空的，而在我们将要挂载分区时在这个目录下建立目录，再将我们将要访问的设备挂载在这个目录上，这样我们就可访问文件了。（注意在GNOME中，只有挂载到/media的文件夹才会显示在“计算机”中，挂载到/mnt不会做为特殊设备显示，详见自动挂载分区）</p>
<p><strong>/opt</strong><br>多数第三方软件默认安装到此位置，如Adobe Reader、google-earth等。并不是每个系统都会创建这个目录。</p>
<p><strong>/proc</strong><br>它是存在于内存中的虚拟文件系统。里面保存了内核和进程的状态信息。多为文本文件，可以直接查看。如/proc/cpuinfo保存了有关CPU的信息。</p>
<p><strong>/root</strong><br>这是根用户的主目录。与保留给个人用户的/home下的目录很相似，该目录中还包含仅与根用户有关的条目。</p>
<p><strong>/sbin</strong><br>供超级用户使用的可执行文件，里面多是系统管理命令，如fsck, reboot, shutdown, ifconfig等。</p>
<p><strong>/tmp</strong><br>该目录用以保存临时文件。该目录具有Sticky特殊权限，所有用户都可以在这个目录中创建、编辑文件。但只有文件拥有者才能删除文件。为了加快临时文件的访问速度，有的实现把/tmp放在内存中。</p>
<p><strong>/usr</strong><br>静态的用户级应用程序等，见下。</p>
<p><strong>/var</strong><br>动态的程序数据等，见下文。<br>    var中包括了一些数据文件，如系统日志等。/var的存放使得/usr被只读挂载成为可能。</p>
<pre><code>**## /var目录结构 ##**
**/var/cache**
应用程序的缓存文件
**/var/lib**
应用程序的信息、数据。如数据库的数据等都存放在此文件夹。
**/var/local**
/usr/local中程序的信息、数据
**/var/lock**
锁文件
**/var/log**
日志文件
**/var/opt**
/opt中程序的信息、数据
**/var/run**
正在执行着的程序的信息，如PID文件应存放于此
**/var/spool**
存放程序的假脱机数据（即spool data）
**/var/tmp**
临时文件
</code></pre><h4 id="二、所以分区："><a href="#二、所以分区：" class="headerlink" title="二、所以分区："></a>二、所以分区：</h4><p>使用任何Linux系统，都要有至少两个分区：一个根分区，用“/”表示；另一个是swap（交换）分区（最小应该和内存一样大，最大一般不超过内存的两倍大小），最好把/boot单独创建一个分区上（200M左右）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2014/10/29/开源许可-略知一二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/29/开源许可-略知一二/" itemprop="url">开源许可-略知一二</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-29T21:55:27+08:00">
                2014-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Open-Source/" itemprop="url" rel="index">
                    <span itemprop="name">Open Source</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>很早就开始关注些开源项目，加上这段时间在学习linux的相关东西，毕竟商用与学习是不一样的，所以就不得不全面了解下开源许可了。在此Mark一下。</p>
<p>找了下度娘，搜到一篇很全的说明：<a href="http://blog.csdn.net/techbirds_bao/article/details/8785413" target="_blank" rel="external">http://blog.csdn.net/techbirds_bao/article/details/8785413</a>。</p>
<p>今天看到了一个开源IM工具，是蘑菇街的—<a href="https://github.com/mogutt" target="_blank" rel="external">mogutt</a>，它是基于Apache Licence V2.0的。对商业应用友好的许可。使用者也可以在需要的时候修改代码来满足需要并作为开源或商业产品发布/销售</p>
<p>现在也想学习下QT5，它的开源版本是基于LGPL的。商业软件可以使用，但不能修改LGPL协议的代码，只能使用类库引用。</p>
<p>Linux本身是基于GPL的。商业软件不能使用GPL协议的代码</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mark.z-dd.net/2014/10/23/与SSI的初遇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shell">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DD'echo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/23/与SSI的初遇/" itemprop="url">与SSI的初遇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-23T22:01:38+08:00">
                2014-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前只弄过CGI，今天接触了下SSI（Lwip里httpd的）。</p>
<p>首先补充了下基础知识（来源于网络）：</p>
<p><code>SSI :Server Side Include，是一种类似于ASP的基于服务器的网页制作技术。SSI 具有强大的功能，只要使用一条简单的SSI 命令就可以实现整个网站的内容更新，动态显示时间和日期，以及执行shell和CGI脚本程序等复杂的功能。将内容发送到浏览器之前，可以使用“服务器端包含 (SSI）”指令将文本、图形或应用程序信息包含到网页中。默认扩展名是 .stm、.shtm 和 .shtml。</code></p>
<blockquote>
<p>在Lwip里的httpd中，工作原理：LWIP对于.shtml,.ssi,.shtm后缀的文件，会检测文件中&lt;!–#name–&gt;格式的TAG标志。</p>
<p>然后再这个标记后面添加你想要的字符串。并不是替换，不过这个方法在脚本中不行， &lt;!–#name–&gt;</p>
<p>是html文件的注释，但是在 &lt;script&gt;…&lt;/script&gt;中就不是注释了，所以在添加js代码的时候必须把整个JS脚本添加进来。</p>
</blockquote>
<p>对于SSI使用详解 可移步至：<a href="http://www.dedecms.com/web-art/PHP_jiaocheng/20010528/31257.html" target="_blank" rel="external">http://www.dedecms.com/web-art/PHP_jiaocheng/20010528/31257.html</a> </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">shell</p>
              <p class="site-description motion-element" itemprop="description">the</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="http://weibo.com/91winter" target="_blank" title="Weibo">
                    
                      <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://github.com/winter91" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:winter91@foxmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://echo.z-dd.net/" title="DD'echo(我的技术博)" target="_blank">DD'echo(我的技术博)</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2013 &mdash; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shell</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  

  

  

</body>
</html>
